<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fileway - Settings</title>
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <!-- Title Bar -->
    <div class="titlebar">
        <div class="titlebar-title">
            <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            Settings
        </div>
        <div class="titlebar-buttons">
            <button class="titlebar-btn minimize" onclick="window.fileway.minimizeWindow()">
                <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
            </button>
            <button class="titlebar-btn close" onclick="window.fileway.closeWindow()">
                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
        </div>
    </div>

    <!-- Settings Layout -->
    <div class="settings-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <nav class="sidebar-nav">
                <button class="nav-item" onclick="window.fileway.navigateTo('home.html')" style="margin-bottom: 12px; color: var(--accent-light);">
                    <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                    Back to Home
                </button>

                <button class="nav-item active" data-section="general" onclick="showSection('general')">
                    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58z"/></svg>
                    General
                </button>
                <button class="nav-item" data-section="profile" onclick="showSection('profile')">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    Profile
                </button>
                <button class="nav-item" data-section="devices" onclick="showSection('devices')">
                    <svg viewBox="0 0 24 24"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/></svg>
                    Devices
                </button>
                <button class="nav-item" data-section="help" onclick="showSection('help')">
                    <svg viewBox="0 0 24 24"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
                    Help
                </button>
            </nav>
        </div>

        <!-- Content -->
        <div class="settings-content">
            <!-- General Section -->
            <div id="section-general" class="settings-section fade-in">
                <h1 class="settings-header">General</h1>
                
                <div class="settings-group">
                    <!-- Launch at Login -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Launch at login</div>
                            <div class="settings-row-subtitle">Start Fileway when your PC boots up</div>
                        </div>
                        <div class="settings-row-action">
                            <button class="btn btn-secondary btn-sm" onclick="manageStartup()">Manage</button>
                        </div>
                    </div>

                    <!-- Sound Effects -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Play sound effects</div>
                            <div class="settings-row-subtitle">Notify when a transfer needs attention</div>
                        </div>
                        <div class="settings-row-action">
                            <span class="toggle-label" id="soundLabel">On</span>
                            <div class="toggle active" id="soundToggle" onclick="toggleSound()"></div>
                        </div>
                    </div>

                    <!-- Auto Accept -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Auto-accept</div>
                            <div class="settings-row-subtitle">Accept transfers automatically</div>
                        </div>
                        <div class="settings-row-action">
                            <div class="select-wrapper">
                                <select class="select" id="autoAcceptSelect" onchange="updateAutoAccept()">
                                    <option value="my-devices">From my devices</option>
                                    <option value="everyone">From everyone</option>
                                    <option value="nobody">Never</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Download Location -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Default save location</div>
                            <div class="settings-row-subtitle">Choose where files are saved</div>
                        </div>
                        <div class="settings-row-action">
                            <button class="btn btn-secondary btn-sm" onclick="selectDownloadFolder()" style="gap: 6px;">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                                <span id="downloadLocation">Downloads</span>
                            </button>
                        </div>
                    </div>

                    <!-- Speed Diagnostics -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Speed diagnostics</div>
                            <div class="settings-row-subtitle">Help improve transfer speeds</div>
                        </div>
                        <div class="settings-row-action">
                            <span class="toggle-label" id="speedLabel">Off</span>
                            <div class="toggle" id="speedToggle" onclick="toggleSpeedDiagnostics()"></div>
                            <div class="info-icon" title="Anonymous data helps us optimize">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Desktop notifications</div>
                            <div class="settings-row-subtitle">Show alerts for incoming files</div>
                        </div>
                        <div class="settings-row-action">
                            <span class="toggle-label" id="notifLabel">On</span>
                            <div class="toggle active" id="notifToggle" onclick="toggleNotifications()"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="section-profile" class="settings-section hidden">
                <h1 class="settings-header">Profile</h1>

                <div class="profile-header">
                    <div class="avatar large" id="profileAvatar">
                        PS
                        <div class="avatar-edit" onclick="editAvatar()">
                            <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        </div>
                    </div>
                    <h2 id="profileName">User Name</h2>
                    <p id="profileEmail">user@fileway.local</p>
                </div>

                <div class="settings-group">
                    <!-- Your Name -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Your name</div>
                            <div class="settings-row-subtitle" id="displayName">Display Name</div>
                        </div>
                        <div class="settings-row-action">
                            <button class="btn btn-secondary btn-sm" onclick="editName()">Edit name</button>
                        </div>
                    </div>

                    <!-- Searchable -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Searchable by name</div>
                            <div class="settings-row-subtitle">Help people find you on Fileway</div>
                        </div>
                        <div class="settings-row-action">
                            <span class="toggle-label" id="searchableLabel">On</span>
                            <div class="toggle active" id="searchableToggle" onclick="toggleSearchable()"></div>
                            <div class="info-icon" title="Others can find you by searching your name">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Sign Out -->
                    <div class="settings-row">
                        <div class="settings-row-icon">
                            <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                        </div>
                        <div class="settings-row-content">
                            <div class="settings-row-title">Sign out of Fileway</div>
                            <div class="settings-row-subtitle">You won't be able to receive files anymore</div>
                        </div>
                        <div class="settings-row-action">
                            <button class="btn btn-danger-solid btn-sm" onclick="signOut()">Sign out</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Devices Section -->
            <div id="section-devices" class="settings-section hidden">
                <h1 class="settings-header">Devices</h1>

                <div class="settings-group">
                    <div id="devicesList">
                        <!-- This computer -->
                        <div class="settings-row">
                            <div class="device-icon this-device">
                                <svg viewBox="0 0 24 24"><path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z"/></svg>
                            </div>
                            <div class="settings-row-content">
                                <div class="settings-row-title" id="thisDeviceName">This Computer</div>
                                <div class="settings-row-subtitle">This computer</div>
                            </div>
                            <div class="settings-row-action">
                                <button class="btn btn-secondary btn-sm" onclick="renameDevice()">Rename</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-24 text-center">
                    <a href="#" class="link" onclick="setupDevice()">Set up another device</a>
                </div>
            </div>

            <!-- Help Section -->
            <div id="section-help" class="settings-section hidden">
                <h1 class="settings-header">Help</h1>

                <div class="settings-group">
                    <!-- Email -->
                    <div class="help-row">
                        <div class="help-icon">
                            <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                        </div>
                        <div class="help-content">
                            <div class="help-title">Email</div>
                            <div class="help-subtitle">hello@fileway.app</div>
                        </div>
                        <div class="help-actions">
                            <button class="btn btn-secondary btn-sm" onclick="composeEmail()">Compose</button>
                            <button class="btn btn-secondary btn-sm" onclick="copyEmail()">Copy</button>
                        </div>
                    </div>

                    <!-- Discord -->
                    <div class="help-row">
                        <div class="help-icon">
                            <svg viewBox="0 0 24 24"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189z"/></svg>
                        </div>
                        <div class="help-content">
                            <div class="help-title">Discord</div>
                            <div class="help-subtitle">Join our community!</div>
                        </div>
                        <div class="help-actions">
                            <button class="btn btn-secondary btn-sm" onclick="openDiscord()">Open</button>
                        </div>
                    </div>

                    <!-- Twitter -->
                    <div class="help-row">
                        <div class="help-icon">
                            <svg viewBox="0 0 24 24"><path d="M22.46 6c-.85.38-1.78.64-2.75.76 1-.6 1.76-1.55 2.12-2.68-.93.55-1.96.95-3.06 1.17-.88-.94-2.13-1.53-3.51-1.53-2.66 0-4.81 2.16-4.81 4.81 0 .38.04.75.13 1.1-4-.2-7.58-2.11-9.96-5.02-.42.72-.66 1.56-.66 2.46 0 1.68.85 3.16 2.14 4.02-.79-.02-1.53-.24-2.18-.6v.06c0 2.35 1.67 4.31 3.88 4.76-.4.1-.83.16-1.27.16-.31 0-.62-.03-.92-.08.63 1.96 2.45 3.39 4.61 3.43-1.69 1.32-3.83 2.1-6.15 2.1-.4 0-.8-.02-1.19-.07 2.19 1.4 4.78 2.22 7.57 2.22 9.07 0 14.02-7.52 14.02-14.02 0-.21 0-.42-.01-.63.96-.69 1.79-1.56 2.45-2.55z"/></svg>
                        </div>
                        <div class="help-content">
                            <div class="help-title">Twitter</div>
                            <div class="help-subtitle">@fileway_app</div>
                        </div>
                        <div class="help-actions">
                            <button class="btn btn-secondary btn-sm" onclick="openTwitter()">Open</button>
                        </div>
                    </div>

                    <!-- Website -->
                    <div class="help-row">
                        <div class="help-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                        </div>
                        <div class="help-content">
                            <div class="help-title">Website</div>
                            <div class="help-subtitle">fileway.app</div>
                        </div>
                        <div class="help-actions">
                            <button class="btn btn-secondary btn-sm" onclick="openWebsite()">Open</button>
                        </div>
                    </div>
                </div>

                <div class="app-version">
                    <p>App version 1.0.0</p>
                    <a href="#" onclick="showDiagnostics()">Show diagnostic info</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let settings = {};
        let profile = {};

        // Initialize
        async function init() {
            profile = await window.fileway.getProfile();
            settings = await window.fileway.getSettings();

            // Update profile section
            document.getElementById('profileName').textContent = `${profile.firstName} ${profile.lastName}`;
            document.getElementById('profileEmail').textContent = profile.email;
            document.getElementById('profileAvatar').textContent = 
                (profile.firstName[0] + profile.lastName[0]).toUpperCase();
            document.getElementById('displayName').textContent = `${profile.firstName} ${profile.lastName}`;
            document.getElementById('thisDeviceName').textContent = await window.fileway.getDeviceName();

            // Update settings UI
            updateSettingsUI();
        }

        function updateSettingsUI() {
            // Sound toggle
            const soundToggle = document.getElementById('soundToggle');
            const soundLabel = document.getElementById('soundLabel');
            if (settings.soundEffects) {
                soundToggle.classList.add('active');
                soundLabel.textContent = 'On';
            } else {
                soundToggle.classList.remove('active');
                soundLabel.textContent = 'Off';
            }

            // Speed diagnostics
            const speedToggle = document.getElementById('speedToggle');
            const speedLabel = document.getElementById('speedLabel');
            if (settings.speedDiagnostics) {
                speedToggle.classList.add('active');
                speedLabel.textContent = 'On';
            } else {
                speedToggle.classList.remove('active');
                speedLabel.textContent = 'Off';
            }

            // Notifications
            const notifToggle = document.getElementById('notifToggle');
            const notifLabel = document.getElementById('notifLabel');
            if (settings.notifications !== false) {
                notifToggle.classList.add('active');
                notifLabel.textContent = 'On';
            } else {
                notifToggle.classList.remove('active');
                notifLabel.textContent = 'Off';
            }

            // Searchable
            const searchableToggle = document.getElementById('searchableToggle');
            const searchableLabel = document.getElementById('searchableLabel');
            if (settings.searchableByName !== false) {
                searchableToggle.classList.add('active');
                searchableLabel.textContent = 'On';
            } else {
                searchableToggle.classList.remove('active');
                searchableLabel.textContent = 'Off';
            }

            // Auto accept
            document.getElementById('autoAcceptSelect').value = settings.autoAccept || 'my-devices';

            // Download location
            if (settings.downloadLocation) {
                const folderName = settings.downloadLocation.split('\\').pop();
                document.getElementById('downloadLocation').textContent = folderName;
            }
        }

        // Section navigation
        function showSection(sectionId) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionId) {
                    item.classList.add('active');
                }
            });

            // Update content
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.add('hidden');
            });
            const targetSection = document.getElementById('section-' + sectionId);
            targetSection.classList.remove('hidden');
            targetSection.classList.add('fade-in');
        }

        // Toggle handlers
        async function toggleSound() {
            settings.soundEffects = !settings.soundEffects;
            await window.fileway.setSetting('soundEffects', settings.soundEffects);
            updateSettingsUI();
        }

        async function toggleSpeedDiagnostics() {
            settings.speedDiagnostics = !settings.speedDiagnostics;
            await window.fileway.setSetting('speedDiagnostics', settings.speedDiagnostics);
            updateSettingsUI();
        }

        async function toggleNotifications() {
            settings.notifications = !settings.notifications;
            await window.fileway.setSetting('notifications', settings.notifications);
            updateSettingsUI();
        }

        async function toggleSearchable() {
            settings.searchableByName = !settings.searchableByName;
            await window.fileway.setSetting('searchableByName', settings.searchableByName);
            updateSettingsUI();
        }

        async function updateAutoAccept() {
            const value = document.getElementById('autoAcceptSelect').value;
            settings.autoAccept = value;
            await window.fileway.setSetting('autoAccept', value);
        }

        // Actions
        function manageStartup() {
            window.fileway.openStartupSettings();
        }

        async function selectDownloadFolder() {
            const result = await window.fileway.selectFolder();
            if (result.success) {
                settings.downloadLocation = result.path;
                await window.fileway.setSetting('downloadLocation', result.path);
                updateSettingsUI();
            }
        }

        function editName() {
            window.fileway.navigateTo('name.html');
        }

        function editAvatar() {
            // Avatar editing - future feature
        }

        async function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                await window.fileway.logout();
                window.fileway.navigateTo('login.html');
            }
        }

        function renameDevice() {
            const newName = prompt('Enter new device name:');
            if (newName && newName.trim()) {
                window.fileway.renameDevice(newName.trim());
                document.getElementById('thisDeviceName').textContent = newName.trim();
            }
        }

        function setupDevice() {
            alert('To set up another device, download Fileway on that device and log in with the same email.');
        }

        function composeEmail() {
            window.open('mailto:hello@fileway.app');
        }

        function copyEmail() {
            navigator.clipboard.writeText('hello@fileway.app');
            alert('Email copied to clipboard!');
        }

        function openDiscord() {
            window.open('https://discord.gg/fileway');
        }

        function openTwitter() {
            window.open('https://twitter.com/fileway_app');
        }

        function openWebsite() {
            window.open('https://fileway.app');
        }

        function showDiagnostics() {
            const info = `Fileway v1.0.0\nDevice: ${document.getElementById('thisDeviceName').textContent}\nEmail: ${profile.email}`;
            alert(info);
        }

        init();
    </script>
</body>
</html>
